-- Create Files
loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Functions/CreateFolder"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Functions/CreateKeyFile"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Functions/CreateSettings"))()
-- Update Settings
function updateSetting(i,v,k)
    local myId = game.Players.LocalPlayer.UserId
    local filedata = loadstring(readfile("PowerStorm_Database/"..myId.."/Settings.txt"))
    local contents = filedata()
    
    local newContents = "local Settings = {"
    
    if i == "AutoExec" then
        if v then
            newContents = newContents.."AutoExec = true"
        else
            newContents = newContents.."AutoExec = false"
        end
    else
        newContents = newContents.."AutoExec = "..tostring(contents["AutoExec"])
    end

    if i == "Theme" then
        if k == "Dark" or k == "Light" or k == "Mocha" or k == "Aqua" or k == "Jester" then
            newContents = newContents..",Theme = \""..k.."\""
        end
    else
        newContents = newContents..",Theme = \""..tostring(contents["Theme"]).."\""
    end
    
    writefile("PowerStorm_Database/"..myId.."/Settings.txt", newContents.."}\nreturn Settings")
end

-- Preset
local myId = game.Players.LocalPlayer.UserId
local filedata = loadstring(readfile("PowerStorm_Database/"..myId.."/Settings.txt"))
local contents = filedata()
local presetCounter = false

local Material = loadstring(game:HttpGet("https://raw.githubusercontent.com/Kinlei/MaterialLua/master/Module.lua"))()

local UI = Material.Load({
     Title = "PowerStorm",
     Style = 1,
     SizeX = 500,
     SizeY = 280,
     Theme = tostring(contents["Theme"])
})

local Homepage = UI.New({
    Title = "Home"
})

local keyValue = ""
function updateKey()
    writefile("PowerStorm_Database/"..game.Players.LocalPlayer.UserId.."/Key.txt", keyValue)
end

if table.find(loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Membership"))(),loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Functions/EncryptedPlayerId"))()) then
keyValue = loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Verification/Validate"))()
updateKey()
Homepage.TextField({
    Text = "Membership Access Granted, Press \"Submit Key\" Button"
})
else
Homepage.TextField({
    Text = "Key",
    Callback = function(value)
        keyValue = value
        updateKey()
    end
})
end

Homepage.Button({
    Text = "Submit Key",
    Callback = function()
        if keyValue == loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Verification/Validate"))() then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Hub"))()
        else
            UI.Banner({
                Text = "Invalid Key!"
            })
        end
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\nSubmit the key"            
            })
        end,
    }
})

Homepage.Button({
    Text = "Get Key Link", 
    Callback = function()
        setclipboard(loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Verification/Generate"))())
        UI.Banner({
            Text = "Link copied!"
        })
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\nCopy link to get key on clipboard"            
            })
        end,
    }
})

Homepage.Label({
    Text = "After pressing \"Get Key Link\" Button, paste the link in a browser"
})

Homepage.Button({
    Text = "Copy Discord Link",
    Callback = function()
        setclipboard(loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Home_Settings/Discord_Link"))())
        UI.Banner({
            Text = "Link copied!"
        })
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\nCopy link to get key on clipboard"            
            })
        end,
    }
})

Homepage.Button({
    Text = "Destroy GUI",
    Callback = function()
       game:getService("CoreGui").PowerStorm:destroy()
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\n*Warning* This will remove the GUI"            
            })
        end,
    }
})


local Devpage = UI.New({
    Title = "Dev Log"
})

Devpage.Button({
    Text = "Build version: V1.0.0 alpha",
    Callback = function()
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\nThe version of the PowerStorm script"            
            })
        end,
    }
})

local myLog = loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Home_Settings/Dev_Log"))()
for i = 1, #myLog do
    Devpage.Label({
    Text = myLog[i]
    })
end

local Gamepage = UI.New({
    Title = "games"
})

local myGame = loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Home_Settings/Games"))()
for i = 1, #myGame do
    Gamepage.Label({
    Text = myGame[i]
    })
end

local Memberpage = UI.New({
    Title = "Membership"
})

Memberpage.Button({
    Text = "Buy membership",
    Callback = function()
        UI.Banner({
            Text = "Working in progress"
        })
    end,
    Menu = {
        Information = function(self)
            UI.Banner({
                Text = "\nPurchase unrestricted access to PowerStorm"            
            })
        end
    }
})

Memberpage.Label({
    Text = "After pressing \"Buy membership\" Button, paste the link in a browser"
})

Memberpage.Label({
    Text = "NOTICE: Membership is still being worked on!"
})

local Settingpage = UI.New({
    Title = "Settings"
})

Settingpage.Toggle({
    Text = "Auto execute",
    Callback = function(value)
        updateSetting("AutoExec",value)
        if value then
            if keyValue == loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Verification/Validate"))() then
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Database/Hub"))()
            else
                UI.Banner({
                    Text = "Key is outdated! Auto execution has stopped working."
                })
            end
        end
    end,
    Enabled = contents["AutoExec"]
})

Settingpage.Dropdown({
    Text = "Theme",
    Callback = function(value)
        if presetCounter then
            updateSetting("Theme",true,value)
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Power-Storm/PowerStorm_Hub/main/Version/Latest"))()
        end
    end,
    Options = {"Dark", "Light", "Mocha", "Aqua", "Jester"}
})

presetCounter = true
